<!DOCTYPE html>
<html lang="fr">
<head>
    <title>Archives JanusEye</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { background: #0a0a0a; color: white; font-family: sans-serif; text-align: center; margin: 0; }
        .header-bar { padding: 20px; background: #111; border-bottom: 1px solid #333; position: sticky; top: 0; z-index: 100; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 15px; padding: 20px; }
        .item { background: #1a1a1a; padding: 10px; border-radius: 8px; border: 1px solid #333; position: relative; }
        .item img { width: 100%; border-radius: 4px; display: block; cursor: pointer; border: 1px solid transparent; }
        .item img:hover { border-color: #555; }
        .filename { font-size: 0.75em; color: #aaa; margin-top: 8px; }
        .btn { display: inline-block; padding: 10px 20px; color: white; text-decoration: none; border-radius: 5px; border: 1px solid #444; font-size: 14px; margin: 5px; cursor: pointer; }
        .btn-back { background: #333; }
        .btn-danger { background: #800; border-color: #a00; }
        
        /* Visionneuse (Overlay) */
        #overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 1000; justify-content: center; align-items: center; }
        #overlay img { max-width: 95%; max-height: 85%; border: 2px solid #555; user-select: none; }
        .nav-info { position: absolute; bottom: 20px; color: #aaa; font-size: 0.9em; width: 100%; pointer-events: none; }

        /* Boutons de navigation tactiles */
        .touch-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: none;
            padding: 30px 15px;
            font-size: 30px;
            cursor: pointer;
            z-index: 1100;
            border-radius: 5px;
            transition: 0.3s;
        }
        .touch-nav:active { background: rgba(255, 255, 255, 0.3); }
        .prev-btn { left: 10px; }
        .next-btn { right: 10px; }

        /* Masquer les fl√®ches sur PC si on veut un look √©pur√©, ou les laisser pour la souris */
        @media (min-width: 800px) {
            .touch-nav { background: rgba(255, 255, 255, 0.05); }
            .touch-nav:hover { background: rgba(255, 255, 255, 0.2); }
        }
    </style>
</head>

<body>
    <div class="header-bar">
        <h2>Archives Photos</h2>
        <a href="./" class="btn btn-back">‚Üê Retour Direct</a>
        <a href="clear_gallery" class="btn btn-danger" onclick="return confirm('Vider toute la galerie ?');">Vider Tout</a>
    </div>

    <div class="grid" id="main-grid">
        {% for file in files %}
        <div class="item">
            <img src="./get_video/{{ file }}" class="thumb" onclick="openImg({{ loop.index0 }})">
            <div class="filename">{{ file }}</div>
            <div style="display: flex; gap: 5px; margin-top: 10px;">
                <a href="./download/{{ file }}" style="flex: 1; background: #00d9ff; color: black; text-align: center; padding: 5px; border-radius: 4px; text-decoration: none; font-weight: bold; font-size: 0.8em;">üì•</a>
                <a href="./delete_image/{{ file }}" style="flex: 1; background: #d32f2f; color: white; text-align: center; padding: 5px; border-radius: 4px; text-decoration: none; font-size: 0.8em;" onclick="return confirm('Supprimer ?')">üóëÔ∏è</a>
            </div>
        </div>
        {% endfor %}
    </div>

    <div id="overlay">
        <button class="touch-nav prev-btn" onclick="changeImg(-1)">&#10094;</button>
        <button class="touch-nav next-btn" onclick="changeImg(1)">&#10095;</button>
        
        <img id="overlay-img" src="" onclick="closeImg()">
        
        <div class="nav-info">
            <span id="img-counter"></span><br>
            Tactile : Glisser ou utiliser les fl√®ches<br>
            Clavier : [ ‚Üê ] [ ‚Üí ] - [ ECHAP ] pour fermer
        </div>
    </div>

    <script>
        const images = Array.from(document.querySelectorAll('.thumb')).map(img => img.src);
        let currentIndex = 0;
        const overlay = document.getElementById('overlay');
        const overlayImg = document.getElementById('overlay-img');
        const counter = document.getElementById('img-counter');

        function openImg(index) {
            currentIndex = index;
            updateOverlay();
            overlay.style.display = 'flex';
        }

        function closeImg() {
            overlay.style.display = 'none';
        }

        function changeImg(step) {
            currentIndex = (currentIndex + step + images.length) % images.length;
            updateOverlay();
        }

        function updateOverlay() {
            overlayImg.src = images[currentIndex];
            counter.innerText = `Photo ${currentIndex + 1} / ${images.length}`;
        }

        // Navigation Clavier
        window.onkeydown = function(e) {
            if (overlay.style.display === 'flex') {
                if (e.key === "ArrowRight" || e.key === "Right") changeImg(1);
                else if (e.key === "ArrowLeft" || e.key === "Left") changeImg(-1);
                else if (e.key === "Escape") closeImg();
            }
        };

        // --- GESTION DU BALAYAGE (SWIPE) POUR SMARTPHONE ---
        let touchstartX = 0;
        let touchendX = 0;

        overlay.addEventListener('touchstart', e => {
            touchstartX = e.changedTouches[0].screenX;
        }, {passive: true});

        overlay.addEventListener('touchend', e => {
            touchendX = e.changedTouches[0].screenX;
            handleGesture();
        }, {passive: true});

        function handleGesture() {
            if (touchendX < touchstartX - 50) changeImg(1);  // Glisser vers la gauche -> Suivant
            if (touchendX > touchstartX + 50) changeImg(-1); // Glisser vers la droite -> Pr√©c√©dent
        }
    </script>
</body>
</html>
